<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎵 Melody Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #2d3748;
        transition: all 0.3s ease;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .control-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        border: 1px solid rgba(255,255,255,0.2);
    }

    .controls-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .control-group {
        display: flex;
        flex-direction: column;
    }

    .control-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #4a5568;
        font-size: 0.9rem;
    }

    .control-group input,
    .control-group select {
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
    }

    .control-group input:focus,
    .control-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .slider-container {
        position: relative;
    }

    .slider {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: #e2e8f0;
        outline: none;
        -webkit-appearance: none;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .slider-value {
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        background: #667eea;
        color: white;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .toggle {
        position: relative;
        width: 50px;
        height: 25px;
        background: #e2e8f0;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .toggle.active {
        background: #667eea;
    }

    .toggle-knob {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 21px;
        height: 21px;
        background: white;
        border-radius: 50%;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle.active .toggle-knob {
        transform: translateX(25px);
    }

    .preview-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        background: #f7fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.5rem;
    }

    .preview-button:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .generate-button {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 15px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        margin-top: 20px;
    }

    .generate-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .melody-display {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        min-height: 300px;
    }

    .staff-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .staff {
        position: relative;
        height: 120px;
        margin: 20px 0;
    }

    .staff-line {
        position: absolute;
        width: 100%;
        height: 1px;
        background: #2d3748;
        left: 0;
    }

    .staff-line:nth-child(1) { top: 20px; }
    .staff-line:nth-child(2) { top: 40px; }
    .staff-line:nth-child(3) { top: 60px; }
    .staff-line:nth-child(4) { top: 80px; }
    .staff-line:nth-child(5) { top: 100px; }

    .clef {
        position: absolute;
        left: 10px;
        top: 30px;
        font-size: 3rem;
        color: #2d3748;
        font-weight: bold;
    }

    .interactive-controls {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        border: 1px solid rgba(255,255,255,0.2);
    }

    .reveal-section {
        margin-bottom: 30px;
    }

    .reveal-section h3 {
        margin-bottom: 15px;
        color: #4a5568;
        font-size: 1.1rem;
    }

    .reveal-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .reveal-button {
        padding: 10px 16px;
        background: #f7fafc;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .reveal-button.revealed {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .reveal-button:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .playback-section h3 {
        margin-bottom: 15px;
        color: #4a5568;
        font-size: 1.1rem;
    }

    .speed-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .speed-button {
        padding: 8px 16px;
        background: #f7fafc;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .speed-button.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .replay-button {
        padding: 12px 24px;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .replay-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
    }

    .note {
        position: absolute;
        font-family: 'Times New Roman', serif;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .note:hover {
        transform: scale(1.1);
        color: #667eea;
    }

    .note-head {
        font-size: 1.8rem;
    }

    .note-stem {
        position: absolute;
        width: 1px;
        background: #2d3748;
    }

    .note-beam {
        position: absolute;
        height: 3px;
        background: #2d3748;
    }

    .rest {
        position: absolute;
        font-size: 1.5rem;
        color: #4a5568;
    }

    .sharp, .flat {
        position: absolute;
        font-size: 1rem;
        color: #2d3748;
        left: -8px;
    }

    .time-signature {
        position: absolute;
        left: 50px;
        top: 45px;
        font-size: 1.2rem;
        font-weight: bold;
        color: #2d3748;
    }

    .key-signature {
        position: absolute;
        left: 70px;
        top: 30px;
        font-size: 1.2rem;
        color: #2d3748;
    }

    @media (max-width: 768px) {
        .controls-grid {
            grid-template-columns: 1fr;
        }
        
        .reveal-buttons {
            justify-content: center;
        }
        
        .speed-buttons {
            justify-content: center;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🎵 Melody Generator</h1>
            <p>Create beautiful melodies with customizable parameters</p>
        </header>

```
    <!-- Control Panel -->
    <section class="control-panel">
        <div class="controls-grid">
            <!-- Bars Slider -->
            <div class="control-group">
                <label for="bars">Number of Bars</label>
                <div class="slider-container">
                    <input type="range" id="bars" class="slider" min="1" max="8" value="4">
                    <div class="slider-value" id="barsValue">4</div>
                </div>
            </div>

            <!-- Voices Selector -->
            <div class="control-group">
                <label for="voices">Voices</label>
                <select id="voices">
                    <option value="1">1 Voice</option>
                    <option value="2">2 Voices</option>
                </select>
            </div>

            <!-- Instrument Dropdown -->
            <div class="control-group">
                <label for="instrument">Instrument</label>
                <select id="instrument">
                    <option value="piano">Piano</option>
                    <option value="strings">Strings</option>
                    <option value="synth">Synth</option>
                    <option value="guitar">Guitar</option>
                    <option value="flute">Flute</option>
                </select>
            </div>

            <!-- Key Selection -->
            <div class="control-group">
                <label for="key">Key</label>
                <select id="key">
                    <option value="C">C Major</option>
                    <option value="G">G Major</option>
                    <option value="D">D Major</option>
                    <option value="A">A Major</option>
                    <option value="E">E Major</option>
                    <option value="B">B Major</option>
                    <option value="F#">F# Major</option>
                    <option value="C#">C# Major</option>
                    <option value="F">F Major</option>
                    <option value="Bb">Bb Major</option>
                    <option value="Eb">Eb Major</option>
                    <option value="Ab">Ab Major</option>
                    <option value="Db">Db Major</option>
                    <option value="Gb">Gb Major</option>
                    <option value="Am">A Minor</option>
                    <option value="Em">E Minor</option>
                    <option value="Bm">B Minor</option>
                    <option value="F#m">F# Minor</option>
                    <option value="C#m">C# Minor</option>
                    <option value="G#m">G# Minor</option>
                    <option value="D#m">D# Minor</option>
                    <option value="A#m">A# Minor</option>
                    <option value="Dm">D Minor</option>
                    <option value="Gm">G Minor</option>
                    <option value="Cm">C Minor</option>
                    <option value="Fm">F Minor</option>
                    <option value="Bbm">Bb Minor</option>
                    <option value="Ebm">Eb Minor</option>
                    <option value="C_pent">C Pentatonic</option>
                    <option value="G_pent">G Pentatonic</option>
                    <option value="D_pent">D Pentatonic</option>
                    <option value="A_pent">A Pentatonic</option>
                    <option value="E_pent">E Pentatonic</option>
                </select>
            </div>

            <!-- Shortest Note -->
            <div class="control-group">
                <label for="shortestNote">Shortest Note</label>
                <select id="shortestNote">
                    <option value="1/8">1/8 Note</option>
                    <option value="1/16">1/16 Note</option>
                    <option value="1/32">1/32 Note</option>
                </select>
            </div>

            <!-- Syncopated Rhythm Toggle -->
            <div class="control-group">
                <label>Syncopated Rhythm</label>
                <div class="toggle-container">
                    <div class="toggle" id="syncopatedToggle">
                        <div class="toggle-knob"></div>
                    </div>
                    <span id="syncopatedText">Off</span>
                </div>
            </div>

            <!-- Preview Button -->
            <div class="control-group">
                <label>Preview</label>
                <div class="preview-button" id="previewButton">
                    👁️
                </div>
            </div>
        </div>

        <button class="generate-button" id="generateButton">
            🎼 Generate Melody
        </button>
    </section>

    <!-- Melody Display -->
    <section class="melody-display">
        <div id="staffContainer">
            <div class="placeholder-text">
                Click "Generate Melody" to create your musical composition
            </div>
        </div>
    </section>

    <!-- Interactive Controls -->
    <section class="interactive-controls">
        <div class="reveal-section">
            <h3>🧩 Reveal Bars</h3>
            <div class="reveal-buttons" id="revealButtons">
                <!-- Buttons will be generated dynamically -->
            </div>
        </div>

        <div class="playback-section">
            <h3>🎵 Playback Controls</h3>
            <div class="speed-buttons">
                <div class="speed-button" data-speed="0.25">0.25x</div>
                <div class="speed-button" data-speed="0.5">0.5x</div>
                <div class="speed-button active" data-speed="0.75">0.75x</div>
                <div class="speed-button" data-speed="1">1x</div>
            </div>
            <button class="replay-button" id="replayButton">
                ▶️ Replay Melody
            </button>
        </div>
    </section>
</div>

<script>
    // Global state
    let generatedMelody = null;
    let currentSpeed = 0.75;
    let revealedBars = new Set();

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
        initializeControls();
        updateRevealButtons();
    });

    function initializeControls() {
        // Bars slider
        const barsSlider = document.getElementById('bars');
        const barsValue = document.getElementById('barsValue');
        
        barsSlider.addEventListener('input', function() {
            barsValue.textContent = this.value;
            updateRevealButtons();
        });

        // Syncopated toggle
        const syncopatedToggle = document.getElementById('syncopatedToggle');
        const syncopatedText = document.getElementById('syncopatedText');
        
        syncopatedToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            syncopatedText.textContent = this.classList.contains('active') ? 'On' : 'Off';
        });

        // Generate button
        document.getElementById('generateButton').addEventListener('click', generateMelody);

        // Preview button
        document.getElementById('previewButton').addEventListener('click', previewMelody);

        // Speed buttons
        document.querySelectorAll('.speed-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.speed-button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentSpeed = parseFloat(this.dataset.speed);
            });
        });

        // Replay button
        document.getElementById('replayButton').addEventListener('click', replayMelody);
    }

    function updateRevealButtons() {
        const numBars = parseInt(document.getElementById('bars').value);
        const revealButtons = document.getElementById('revealButtons');
        
        revealButtons.innerHTML = '';
        revealedBars.clear();
        
        for (let i = 1; i <= numBars; i++) {
            const button = document.createElement('div');
            button.className = 'reveal-button';
            button.textContent = `Bar ${i}`;
            button.dataset.bar = i;
            
            button.addEventListener('click', function() {
                this.classList.toggle('revealed');
                const barNum = parseInt(this.dataset.bar);
                
                if (this.classList.contains('revealed')) {
                    revealedBars.add(barNum);
                } else {
                    revealedBars.delete(barNum);
                }
                
                updateMelodyDisplay();
            });
            
            revealButtons.appendChild(button);
        }
    }

    function generateMelody() {
        const bars = parseInt(document.getElementById('bars').value);
        const voices = parseInt(document.getElementById('voices').value);
        const instrument = document.getElementById('instrument').value;
        const shortestNote = document.getElementById('shortestNote').value;
        const syncopated = document.getElementById('syncopatedToggle').classList.contains('active');

        // Generate the melody data
        generatedMelody = createMelodyData(bars, voices, instrument, shortestNote, syncopated);
        
        // Reset revealed bars
        revealedBars.clear();
        document.querySelectorAll('.reveal-button').forEach(button => {
            button.classList.remove('revealed');
        });
        
        // Update display
        updateMelodyDisplay();
    }

    function createMelodyData(bars, voices, instrument, shortestNote, syncopated) {
        // This is where the melody generation logic will go
        // For now, creating a basic structure
        return {
            bars: bars,
            voices: voices,
            instrument: instrument,
            shortestNote: shortestNote,
            syncopated: syncopated,
            notes: generateNotes(bars, voices, shortestNote, syncopated)
        };
    }

    function generateNotes(bars, voices, shortestNote, syncopated) {
        // Placeholder note generation - this will be expanded
        const notes = [];
        
        for (let voice = 0; voice < voices; voice++) {
            const voiceNotes = [];
            for (let bar = 0; bar < bars; bar++) {
                const barNotes = [];
                // Generate 4-8 notes per bar depending on shortest note value
                const notesPerBar = shortestNote === '1/32' ? 8 : shortestNote === '1/16' ? 6 : 4;
                
                for (let i = 0; i < notesPerBar; i++) {
                    barNotes.push({
                        pitch: Math.floor(Math.random() * 12) + (voice === 0 ? 60 : 48), // MIDI note numbers
                        duration: shortestNote,
                        position: i * (1 / notesPerBar)
                    });
                }
                voiceNotes.push(barNotes);
            }
            notes.push(voiceNotes);
        }
        
        return notes;
    }

    function updateMelodyDisplay() {
        const staffContainer = document.getElementById('staffContainer');
        
        if (!generatedMelody) {
            staffContainer.innerHTML = '<div class="placeholder-text">Click "Generate Melody" to create your musical composition</div>';
            return;
        }

        const voices = generatedMelody.voices;
        
        staffContainer.innerHTML = '';
        
        // Create staff(s)
        for (let voice = 0; voice < voices; voice++) {
            const staffDiv = document.createElement('div');
            staffDiv.className = 'staff-container';
            
            const staff = document.createElement('div');
            staff.className = 'staff';
            
            // Add staff lines
            for (let i = 0; i < 5; i++) {
                const line = document.createElement('div');
                line.className = 'staff-line';
                staff.appendChild(line);
            }
            
            // Add clef
            const clef = document.createElement('div');
            clef.className = 'clef';
            clef.textContent = voice === 0 ? '𝄞' : '𝄢'; // Treble or Bass clef
            staff.appendChild(clef);
            
            // Add notes for revealed bars
            addNotesToStaff(staff, voice, generatedMelody.notes[voice]);
            
            staffDiv.appendChild(staff);
            staffContainer.appendChild(staffDiv);
        }
    }

    function addNotesToStaff(staff, voice, voiceNotes) {
        voiceNotes.forEach((barNotes, barIndex) => {
            if (revealedBars.has(barIndex + 1)) {
                barNotes.forEach((note, noteIndex) => {
                    const noteElement = document.createElement('div');
                    noteElement.style.position = 'absolute';
                    noteElement.style.left = (80 + (barIndex * 200) + (noteIndex * 30)) + 'px';
                    noteElement.style.top = getPitchPosition(note.pitch, voice) + 'px';
                    noteElement.style.fontSize = '1.5rem';
                    noteElement.style.color = '#2d3748';
                    noteElement.textContent = '♪';
                    staff.appendChild(noteElement);
                });
            }
        });
    }

    function getPitchPosition(midiNote, voice) {
        // Convert MIDI note to staff position
        // This is a simplified version - real implementation would be more complex
        const basePosition = voice === 0 ? 60 : 80; // Treble vs Bass clef base
        const pitchOffset = (72 - midiNote) * 2; // Approximate staff line spacing
        return Math.max(10, Math.min(110, basePosition + pitchOffset));
    }

    function previewMelody() {
        // Placeholder for preview functionality
        alert('Preview functionality - would play a short snippet of the melody');
    }

    function replayMelody() {
        if (!generatedMelody) {
            alert('Please generate a melody first!');
            return;
        }
        
        // Placeholder for replay functionality
        alert(`Replaying melody at ${currentSpeed}x speed`);
    }
</script>
```

</body>
</html>